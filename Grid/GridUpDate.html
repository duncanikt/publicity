<!DOCTYPE html>
<head>
  <title>Update Form</title>
</head>
<body>
  <h3>修改记录</h3>
  <label for="field01">單號:</label>
  <input type="text" id="field01Input" name="field01" value="">
  <br>
  <label for="field02">字段 02:</label>
  <input type="text" id="field02Input" name="field02" value="">
  <br>
  <label for="field03">字段 03:</label>
  <input type="text" id="field03Input" name="field03" value="">
  <br>
  <label for="field04">字段 04:</label>
  <input type="text" id="field04Input" name="field04" value="">
  <br>
  <label for="field05">字段 05:</label>
  <input type="date" id="field05Input" name="field05" value="">
  <br>

  <!-- 其他字段输入框 -->
  <button onclick="saveUpdate()">儲存</button>

  <script>
    console.log("Hello GridUpDate.html自己");
    // 从URL参数中获取字段的值
    var field00Value = decodeURIComponent(getParameterByName('field01'));
    var field01Value = decodeURIComponent(getParameterByName('field01'));
    // 获取其他字段的值
    var field02Value = decodeURIComponent(getParameterByName('field02'));
    var field03Value = decodeURIComponent(getParameterByName('field03'));
    var field04Value = decodeURIComponent(getParameterByName('field04'));
    var field05Value = decodeURIComponent(getParameterByName('field05'));
    // 将字段的值设置到输入框中
    document.getElementById('field01Input').value = field01Value;
    // 设置其他字段的值
    document.getElementById('field02Input').value = field02Value;
    document.getElementById('field03Input').value = field03Value;
    document.getElementById('field04Input').value = field04Value;
    document.getElementById('field05Input').value = field05Value;
    function getParameterByName(name) {
      name = name.replace(/[\[\]]/g, '\\$&');
      var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(window.location.href);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function saveUpdate() {
    var field01Input = document.getElementById('field01Input').value;
    var field05Input = document.getElementById('field05Input');
    if (!field05Input.value) {
      var popupWindow = window.open('', '_blank', 'width=200,height=100');
      popupWindow.document.write('<h2 style="text-align: center;">請填寫日期</h2>');
      popupWindow.document.write('<button onclick="window.close()" style="display: block; margin: 0 auto;">確認</button>');
      return;
    }
    if (field01Input.trim() === '') {
    var popupWindow = window.open('', '_blank', 'width=200,height=100');
    popupWindow.document.write('<h2 style="text-align: center;">單號空白</h2>');
    popupWindow.document.write('<button onclick="window.close()" style="display: block; margin: 0 auto;">確認</button>');
    return;
  }
    if (isNaN(field01Input)) {
    var popupWindow = window.open('', '_blank', 'width=200,height=100');
    popupWindow.document.write('<h2 style="text-align: center;">單號只能輸入數字</h2>');
    popupWindow.document.write('<button onclick="window.close()" style="display: block; margin: 0 auto;">確認</button>');
    return;
    }

  var field00Value = decodeURIComponent(getParameterByName('field01'));
  var field01Value = document.getElementById('field01Input').value;
  var field02Value = document.getElementById('field02Input').value;
  var field03Value = document.getElementById('field03Input').value;
  var field04Value = document.getElementById('field04Input').value;
  var field05Value = document.getElementById('field05Input').value;

  var data = {
    field00: field00Value,
    field01: field01Value,
    field02: field02Value,
    field03: field03Value,
    field04: field04Value,
    field05: field05Value
  };
  console.log("錯誤10");
  fetch('http://localhost:8081/update', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(function(response) {
  if (response.ok) {
    // 修改成功，打开新窗口显示成功消息并关闭当前窗口
    var popupWindow = window.open('', '_blank', 'width=200,height=100');
    popupWindow.document.write('<h2 style="text-align: center;">修改成功</h2>');
    setTimeout(function() {
      popupWindow.close();
      window.close();
    }, 1500);
  } else {
    var popupWindow = window.open('', '_blank', 'width=200,height=100');
    popupWindow.document.write('<h2 style="text-align: center;">資料有誤</h2>');
    popupWindow.document.write('<button onclick="window.close()" style="display: block; margin: 0 auto;">確認</button>');
  }
})

    .catch(function(error) {
      console.log('Error:', error);
    });
}






window.addEventListener('DOMContentLoaded', function() {
  var urlParams = new URLSearchParams(window.location.search);
  var field05Value = urlParams.get('field05');

  if (field05Value) {
    document.getElementById('field05Input').value = new Date(field05Value).toISOString().split('T')[0];
  }
});

  
  </script>
</body>
</html>
